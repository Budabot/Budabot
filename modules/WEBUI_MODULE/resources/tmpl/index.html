{% extends "base.html" %}

{% block title %}Home{% endblock %}

{% block head %}
{{ parent() }}
<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.8.3/jquery.min.js"></script>
<script src="http://autobahn.s3.amazonaws.com/js/autobahn.min.js"></script>
<script type="text/javascript">

	logMaxLines = 1000;

	$(document).ready(function() {

		function isLogConsoleAtBottom() {
			if (log_console.scrollTopMax != undefined) {
				return log_console.scrollTop == log_console.scrollTopMax;
			}
			return true;
		}

		function scrollLogConsoleToBottom() {
			if (log_console.scrollTopMax != undefined) {
				log_console.scrollTop = log_console.scrollTopMax;
			} else {
				log_console.scrollTop = 999999999;
			}
		}

		function limitLogConsoleLines() {
			if (log_console.children.length > logMaxLines) {
				$('#log_console').find(':first-child').remove();
			}
		}

		function addMessageToLogConsole(message) {
			atBottom = isLogConsoleAtBottom();

			log_console.innerHTML += "<div>" + message + "</div>\n";

			limitLogConsoleLines();

			if (atBottom) {
				scrollLogConsoleToBottom();
			}
		}

		ab.connect('{{ webSocketUri }}',

			function(session) {
				console.log('Connected to WebSocket');
				session.subscribe('{{ logEventsTopic }}', function (topic, event) {
					addMessageToLogConsole(event);
				});
			},

			function(code, reason) {
				addMessageToLogConsole(reason);
			}
		);
	});
</script>
{% endblock %}

{% block content %}
<article>
	<header>
		<h1>Console Messages</h1>
	</header>

	<div id="log_console"></div>
</article>
{% endblock %}
